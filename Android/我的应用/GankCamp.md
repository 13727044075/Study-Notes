做一个开源项目(暂时命名为GankCamp)，数据来自干货集中营，计划1-2个月完成初始版本；需要学习MVP架构，一些新的控件，如SwipeRefreshLayout,RecyclerView,Snackbar,Toolbar等，第三方库，如retrofit，okhttp，butterknife,图片加载库等，还有就是Rxjava。

##### 计划：
1. 先搭建一个基本的ui框架，建立一个项目。
2. 学习需要用到的控件，

* CoordinatorLayout
* AppBarLayout
* SwipeRefreshLayout,
* RecyclerView,
* Snackbar,
* Toolbar；
* Floathing Action Buttons
* NavigationView

3. 学习MVP架构的实现，慢慢开始实现功能
4. 学习第三方库,RxJava
5. 完成GankCamp的初始版本


---

##### 3.20  总结
目前进度是，使用上SwipeRrefreshLayout,RecycleView,NavigationView,Toolbar这几个控件，使用基本的网络请求，HttpURLConnection方法来进行请求数据，然后进行JSON格式的解析，并且在子线程中进行这个网络请求，这部分需要总结下，特别是要注意子线程开启，已经对JSON格式的解析。

需要总结的部分，暂时有，**RecycleView的使用，特别是其adapter的使用，NavigationView的基本使用，还有就是网络编程部分，基本的请求方法，写法，JSON格式的解析，以及多线程编程，即Thread,还有就是异步处理消息，handler,Looper等**

**下一步计划是**


- [x] 1. 实现点击功能，需要增加一个Activity，使用WebView，即可以查看具体内容；(实现，还有图片的需要实现)
- [x] 2. 数据缓存以及加载更多数据的功能；(加载更多数据功能初步实现，数据缓存已经添加)
- [ ] 3. 对界面的优化等，完成初始版本，图片展示使用瀑布流；
- [ ] 4. 学习MVP架构，完成架构的优化；(MVP架构初步实现)
- [ ] 5. 优化网络请求部分，使用第三方库；(目前使用的是volley库，计划更换成OkHttp+Retrofit)
- [ ] 6. 增加一些动画效果,如不同Activity或者Fragment之间的切换,点击查看一张图片的时候;
- [ ] 7. 增加夜间模式,可以使用一个悬浮按钮实现;增加一个返回到顶部的悬浮按钮;向下滑动的时候,可以隐藏Toolbar;
- [ ] 8. 收藏功能，在首页可以每个item增加一个心形，点击变实心表示收藏；(收藏功能实现，但是首页没有实现)
- [ ] 9. 登录功能，分享功能；(分享功能实现，登录功能还没有)
- [ ] 10. 首页的展示可以切换模式，一种是大图加标题，即上图下字，一种是小图加标题，左图右字，而且可以右边在添加类别以及发布日期，还可以是详细展示每天的内容，详细展示的时候，在滑动的时候，类别标题会固定不动，直到遇到下一个类别标题才被替换的效果。

**需要总结的内容是**

- [ ] 1. `RecycleView`控件的基本使用，其adapter的使用，decoration的使用等；
- [ ] 2. `NavigationView`控件的使用，包括`DrawerLayout`控件的使用；
- [ ] 3. `Toolbar`，`CoordinatorLayout`，`AppBarLayout`等控件使用总结
- [ ] 4. 网络请求库的总结，包括基本的`HttpURLConnection`,`Volley`等第三方库，还有就是JSON的使用，GSON的使用
- [ ] 5. `Fragment`的基本使用，如何切换，以及与`ViewPager`结合使用的方法
- [ ] 6. `MVP`架构的总结
- [ ] 7. 图片显示，加载，缓存的总结，包括如加载库`Glide`的使用总结
- [ ] 8. 数据库使用，如自带的`SQLiteDatabase`，以及第三方库，如`Realm`
- [ ] 9. 常用工具类总结

---

##### 3.23 总结
今天增加了一个WebActivity,WebFragment，以及BaseActivity，实现了点击功能，但是webView的功能还有问题，总是出现空指针的错误，暂时只能使用Intent来使用浏览器来打开网页，还需要看看怎么解决这个问题，看下WebView这个控件是如何使用的。

设置了在按下返回键的操作，使用onKeyDown()这个方法，并判断当前KeyCode是否等于KeyEvent.KEYCODE_BACK来确定是否是按下返回键，使用onBackPressed()这个方法可以执行退出Activity。

---

##### 3.24 总结

今天改变了下布局，没有使用CardView,只是使用LinearLayout包含一个TextView,然后改变了下字体颜色和大小，然后就是添加了一个ToastUtil类，主要用于管理消息，并使用一个类，继承Application，主要是用于在ToastUtil类中提供整个应用的context。

明天要试下使用Gson来解析JSON格式，然后添加一个DateUtil类来管理日期，在首页这个Fragment是根据时间做请求，并且添加滑动到底部继续加载数据的功能，这几个功能希望是这个周末前完成。


---

##### 3.26 总结
增加了一个DateUtil类来管理日期，使用Gson，需要在`build.gradle`中添加`compile 'com.google.code.gson:gson:2.5'`,但是想使用Gson来解析JSON格式的时候发现出现了错误，后面发现使用`gson.fromJson()`,第一个参数应该是`String`类型才可以，而之前使用的是`JSONArray`,所以出错，改过来后就可以了，这样的好处就是直接得到一个`Gank`类型的List，不用像解析JSON格式那样一个个写代码来获取对应的数据，方便很多；

另外，根据日期来请求数据，得到的json格式跟单独按一个类名或者是使用all得到的数据格式是不同的，这个需要重新建立一个新的解析方法，有点麻烦，考虑是不是要用下第三方库，比如Volley,OkHttp,Retrofit;

修改了一个不太合理的地方，就是在分类展示的时候不需要添加标题，如点到`Android`类别的时候，直接显示数据就可以了，不用在头部添加`Android`这个标题。

然后现在实现了加载更多数据的功能，**但是，需要增加下加载的动画，以便表示是在加载，同时，不知道为什么加载了一次还是两次后，就无法再加载了，显示错误代码是404**，这个问题要好好看看是什么问题，或者需要改用下第三方库，并**稍微总结下基本的网络请求方法，以及解析JSON格式，这个明天做下总结吧。**

---

##### 3.27 总结
今天本来计划是要总结的，但是目前只是记录了下常用工具类的代码，对于网络请求方法的总结，有点提不起劲来总结，感觉也是好久没有好好写个文章，打算再多用几种网络框架，到时一起总结，并写篇博客，要开始让自己每周至少写一篇博客，每天可以写点笔记来总结，然后周末就可以根据这些笔记写篇博客，边学边写，逐渐提高。

晚上增加了两个类，都是跟数据库有关的，用的还是android自带的`SQLiteDatabase`,一个类用于继承这个抽象类，主要是用来创建数据库，目前这个表中只有4项内容，id，链接地址url,JSON格式的数据，以及保存的日期，第二个类则是用来管理数据库，也就是对数据库进行插入数据，查询数据，目前就这两项操作。而且插入数据是使用`replace`操作，也就是数据库中其实只要一项数据。

暂时还没进行测试，这个操作主要是在要获取数据的时候，先从数据库中获取，如果数据库中有保存需要请求的链接的数据，那么就可以不需要进行网络访问，直接加载，当没有的时候再进行加载，然后保存数据内容。


---

##### 3.29 总结
发现之前为什么在加载更多数据时，**显示404错误，这个错误代码表示请求的网页不存在**，通过输出每次加载更多数据请求的url，发现原来每次都在同一个url后面加上请求的pageSize和page，所以后面的网页肯定是不存在的。

今天增加了一个处理返回数据的方法，请查看是否有`error key`，再看是否有`results`，然后再调用`HttpCallBackListener`的方法，分别对应成功和失败，同时在这个函数还加入保存数据的代码。

然后就是对加载更多数据的改进，增加了可以有进度条，即设置`SwipeRefreshLayout`的`isRefreshing`方法为`true`即可。

将获取数据后对数据进行解析以及更新界面都写成一个方法，这样在`getData()`和`getMoreData()`中可以减少代码量，毕竟执行的都是同样的代码。

最后在baseFragment中添加了几个跟`SwipeRefreshLayout`相关的方法，还有就是初始获取数据的方法。

发现在加载数据的时候是会有很卡的情况，然后控制台也显示了绘制时间比较长，这个现象在首页的情况比较严重。

**然后发现点击中文名称分类的都会出错，发现请求错误代码也是404，然后看了下监控器的输出，打印出的`url`,在这个中文名称，如前端，之前都是一个超链接，然后后面就不是了，所以这应该是跟中文字符的编码问题，上网查了下，找到解决方法，就是使用`Uri.encode(str)`即可，**

明天的话，就真的需要使用下Volley这个网络库，然后要添加下分隔线，现在这个看起来不够好看，然后就是首页应该使用每天的数据，所以对解析数据方面估计要增加一个新的方法吧。


---

##### 3.30 总结
首先是对recyclerView的item添加了分隔线，参考了[Android RecyclerView的基本使用](http://joybar.me/?p=41)和[Using-the-RecyclerView](https://github.com/codepath/android_guides/wiki/Using-the-RecyclerView),主要就是利用了recyclerView提供的ItemDecoration类，重写一个类继承它，然后需要提供一个`Drawable`来提供分隔线的颜色和高度，在重新写的类中进行绘制分隔线，并且分为水平布局和垂直布局两种情况。

对于Volley的使用，参考的还是郭霖大神的几篇相关博文，[Android Volley完全解析(一)，初识Volley的基本用法](http://blog.csdn.net/guolin_blog/article/details/17482095)等一系列的有关`Volley`的文章，然后也参考了[基于Volley的便捷网络请求库](https://github.com/Jude95/RequestVolley)，对于使用`Volley`的封装。

不过真的花了好几个小时才弄好，这个库的用法还是比较简单的，首先就是声明一个`RequestQueue`，消息队列，然后初始化一个`Request`对象，然后加入消息队列中即可，所以主要看的就是这个请求对象，在`Volley`中是有三种请求对象的，分别是`StringRequest`,`JsonObjectRequest`以及`ImageRequest`，从其名称都可以知道其作用分别是得到一个字符串，JSON对象以及图片，然后还可以自定义`Request`,这里就是我花了那么多时间的原因，因为要自定义一个使用`Gson`的`Request`，但是自定义这个类的时候，是使用泛型的，即可以传入自定义的类对象，但问题是我希望使用Gson解析Json后返回的是一个`ArrayList<Gank>`，但我在初始化这个`GsonRequest`时，传入的却是`Gank`类，那么使用`Gson`得到的就只是一个 Gank 对象，而不是希望得到的 `ArrayList` 对象，但又无法传入 `ArrayList<Gank>` ，总之这个问题弄了好久，最后还是觉得直接使用`JsonObjectRequest`吧，毕竟也写了好几个方法来对返回的数据进行处理。

然后就是对处理返回的数据的方法进行封装，写成一个类，分别是有一个是对返回的数据进行判断是非请求成功，然后再使用另一个方法来使用`Gson`解析数据，得到 `ArrayList<Gank>`。

本来测试这个方法可以成功，但是退出应用，再次进入却发现无法加载数据了。但再次进行测试后，发现又恢复正常了，有些不够稳定。

今天的效率略低，还影响正常的计划，明天尝试试下用`ImageRequest`来加载图片，然后的话就是使用`OkHttp`，这次用这个新的库，就不用再换了，到时再配合使用`Retorfit`和`RxJava`，然后就是用图片加载库`Glide`，之后就是学习下 MVP 架构，更改架构后，看看时间，有可能需要先弄下界面，应用的图标和每个分类的图标，搞定这个再实现其他的功能，比如`WebView`这个打不开的功能，登录功能，分享，收藏功能以及夜间模式，这些当初写设计方案给嵌入式老师时提到的功能。


---

##### 4.2 总结

思考了好久，才开始处理如果是请求每天的数据，因为每天数据返回的JSON格式跟使用`data/`返回的数据不一样，每天数据返回的`results`中，是有以每个分类名为名字的`JSONArray`，而后者则是没有命名的`JSONArray`，所以需要一个新的解析方法，同时呢，请求每天数据，是工作日才有，周末是返回一个空的，这个也是要处理的，然后就是加载数据也是有所不同。

首先是要新建立一个类，存有几个`List`,分别存对应类别的数据，然后用`gson`解析的时候，就是用这个类的类别作为`fromJson()`的第二个参数。

犹豫了好久，主要是发现在`mainFragment`类中已经写了两百多行代码了，所以决定再写一个`Fragment`,不过好像效果一般，同样也是有好多行代码，但这样至少可以分别处理两种形式的处理，不过暂时实现了请求每天的数据，并且可以加载更多，接下来就是解决下如果跳转到`categoryFragment`的问题了。

发现失败的原因是其实没有将使用`FragmentTransaction`的add方法，同时在使用其`hide()`方法，需要直接告诉其`fragment`是哪一个，要具体的实例对象。

###### 下一步  
**现在是基本弄好这个展示的了，然后就是图片加载，这个打算直接用下`Glide`吧，然后感觉需要弄下MVP的架构，弄完再来更换网络的请求库，以及`RxJava`，搞定这个，应该两周内可以弄完吧，然后就搞定界面以及webView的问题，再之后就是其他的功能，例如登录，收藏，夜间模式，分享**。

###### `Fragment`的使用还是需要好好总结一下，刚刚参考了[Android Fragment应用实战，使用碎片向ActivityGroup说再见](http://blog.csdn.net/guolin_blog/article/details/13171191),以及[Creating and Using Fragments](https://github.com/codepath/android_guides/wiki/Creating-and-Using-Fragments)。


---

##### 4.3 总结

今天只有上午的时间来弄，所以暂时是使用了`Glide`这个图片加载库，也成功加载图片了，但是问题是显示图片的问题，不能完全显示，在宽度上没有完全占据整个屏幕，这个暂时还没找出原因，使用这个库，参考了[Glide - 系列综述](http://mrfu.me/2016/02/28/Glide_Series_Roundup/?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io)--这是一个使用`Glide`的一系列的教程，[Google推荐的图片加载库Glide介绍](http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0327/2650.html)--这篇文章则对比了`Glide`和`Picasso`两个不同的图片加载库，对比结论是`Glide`加载图片以及磁盘缓存的方法都要更好，而且加载速度更快，可以减少`OutOfMemory`的发生，并且可以加载GIF动画，这是`Picasso`不具备的功能，但是后者的图像质量更高。

---
##### 4.4 总结

上午还是在解决图片显示的问题，发现参考的同样是做这个干货集中营分享的一些应用，显示图片是用一个自定义的继承`ImageView`的控件，主要是改变显示图片的比例，即可以选择要显示的宽高比，主要是改写`onMeasure()`方法，我也参考了一个，虽然一开始发现没有图片显示，后来仔细一看是关键的一段代码写错，就是在得到最终要显示的高度或宽度时，计算用的应该是需要保持一致的尺度，即如果设置跟宽度保持一致，那么高度就是`View`本身测量得到的宽度乘以缩放比例。改好这个后，发现就可以实现了。

###### 想法
所以对于图片的展示也是基本可以了，到时候对于分类的图片展示，打算使用瀑布流的形式，也就是需要再增加一个`Fragment`,以及一个`adapter`,这个也是有必要的，毕竟展示的是图片，还是跟正常文字有区别，对于视频的展示，同样也是需要，不过这个可以放到后面吧。

同时希望对于自定义的`ImageView`，看能不能增加一些新的东西，或者对`TextView`也写一个新的自定义控件，可以改变下文字的显示效果，增加点动画，也有在想写个能添加文字的`ImageView`,然后文字的颜色可以提取图片颜色来设置，这样可以熟悉下如何自定义View。今天算是初步尝试，但是其实还是基本参考了，还不是自己完全独立写出来，想出来的。

晚上则是看了一会关于MVP的介绍，网上还是很多这种文章，同时也是有附带一些例子，当然参考的关于干货集中营app的项目，大多数也是使用这种结构的，这是一个如何写一个应用的模式吧，目的当然是为了方便维护，减轻`Activity`或者`Fragment`的负担，将界面UI的逻辑和业务实现分开，添加一个`Presenter`层来管理`Model`和`View`，不过看到其实需要定义很多接口，无论是`Model`,`View`,还是`Presenter`都需要有一个接口，然后就是实现接口的类。

**`Model`**

其主要是实现获取数据，包括网络请求数据，从数据库中读取数据等；

**`View`**

关于UI更新的方法，如加载数据时显示一个加载的进度条，加载完成后取消进度条，以及更新界面，还有就是加载更多数据后更新界面等；

其实现类就是`Activity`或者`Fragment`或者自定义的`View`，然后就是继承上述接口，同时要初始化对于的`Presenter`的对象，在实现对应方法的时候，如果需要有数据，即涉及`Model`的，则调用`Presenter`对象的对应方法。

**`Presenter`**

用来管理`Model`和`View`，所以会初始化这两个层的接口的对象，然后实现一些业务处理的功能。

---

##### 4.6 总结

   上午继续学习MVP架构,看到别人的项目,**发现有把`RecyclerView`重新自定义，加入了加载更多的功能，并且需要实现一个回调功能，还有就是添加了一个`FloatingActionButton`，然后实现下滑就隐藏，往上就出现的功能，这个可以考虑在后面自己也来自定义一个。**
   
下午终于是完成了首页的`MVP`架构，的确是需要好好思考这个`Activity`或者`Fragment`要实现的界面和业务功能有哪些，需要把一些最基本的功能抽出来写在`basePresenter`和`IbaseView`，对于`Model`和`Presenter`层，我都是写了一个接口，然后再写一个实现类，而`Presenter`是在`BasePresenter`中就先声明了一个`IBaseView`的对象，然后在具体的`Presenter`实现类中来具体化这个`IBaseView`的对象，同时在`baseFragment`也声明了一个泛型的`T mPresenter`，然后具体的`Fragment`在继承父类的时候会指定其要用的`Presenter`实现类，这一部分应该是涉及到了Java的泛型，也就是相当于C++里面的模板吧。

首页的内容进行修改，然后的确可以实现，不过这里出现一个问题，就是比如点击其中一个内容，跳转到一个浏览器，就是在执行了`onPause()`方法，然后再回到应用，就执行`onResume()`，就只会显示当前日期的内容，而这个当前日期有可能不是最新的日期，这个暂时有两个解决方法，**第一个就是一直计划的数据缓存，每次先判断在数据库中是否有这个`url`的数据，如果有，就读取并进行解析，而没有就通过网络请求，得到数据后就进行数据缓存，当然对于每天的数据以及分页数据，应该还是要弄两个表分别保存吧，然后肯定需要有可以清除缓存，以及显示当前缓存的设置了；第二个方法就是实现上拉更新数据的功能，这个可以将输入的日期，因为起始日期是获取当前的日期，但是可以令其加一天，毕竟一旦获取到的数据是空的话，是会自动减天数，再获取数据的。**
   
然后发现第二种方法的做法不可取，因为虽然会重新调用读取数据的方法，但是在该方法中又会继续将日期增加，而日期减少是在设置是加载更多数据的前提下，解决方法是如果不是加载更多数据，那么就获取当前日期，并使用这个日期，而不是在判断保持当前日期的变量为空才获取当前日期。不过这种做法，感觉不够人性化，应该返回来的时候定位到之前的位置，所以还是需要数据缓存，同时要记录离开时显示的位置，所以，下一步就是数据缓存的实现！  
   
---

##### 4.9 总结

  首要任务是建立数据库，打算建立两个表，分别保存每天的数据以及分类数据。然后每天的数据表需要保存的数据是`url`,返回的JSON数据中`results`的内容，保存的时间；而分类数据会多一个类别`type`的数据。
  
  然后保存数据应该是在第一次请求数据的时候，在加载更多数据的时候不保存，然后每次打开应用的时候需要先确定当前请求的内容是否已经保存在数据库中，并且查询，如果有，则从数据库中获取即可。
  
  但是后来发现其实建立一个表就可以了，然后又修改了下插入数据的方法，先增加一个方法，用来判断数据库是否已经保存过这条数据，如果是，就不再保存，本来以为应该很简单的，但是发现不知为何总是出错，然后发现似乎数据库的名字没写对，然后就是生成表的语句也没写对。
  
  之后干脆先不弄数据库，因为突然发现一开始加载数据是会同时加载两次相同一天的数据，发现似乎还是将日期的管理放到`fragment`中，然后在`Presenter`的加载数据方法增加一个日期的参数。同时在加载更多数据的时候，需要先获取`Presenter`的日期变量，主要是对于如果是周末的日期，在请求的时候会自动减一，但`Fragment`却是不知道已经减了。
  
  在手机上测试的时候，发现来回点击几个分类后，突然就会奔溃，这个问题，在模拟器上却没有发生，有点奇怪。这个问题，我看了下，在`categroyFragment`中是有段在转换类别的时候，让`recyclerView`可以返回到顶部，不知道是否是这个出现问题，我把它注释掉后，再测试，就没问题了，其实在模拟器上还是发生了一次奔溃，也是在来回点击分类的时候，看到出错的信息显示有关于`recyclerView`，估计应该是这个问题吧，可能是在还没有加载好数据。
  
  然后现在数据缓存的问题还是没有解决，本以为应该很容易的，希望明天可以实现好这个功能。
  
  **此外，感觉为了避免重复，在更新数据前，还是得增加一个方法来判断新获得的数据是否已经存在。**

---
##### 4.11 总结

  想了好久，读取数据库的操作应该添加到哪里，最终还是放在`gankDailyImpl`的`loadDailyData`方法中，放在网络请求前面，如果读取成功，就会回调，那么就不会到网络请求这部分，但是奇怪的是，好像没有成功保存数据，因为关掉网络后，并不能读取到数据。
  
  在命令行查看数据库中的数据时，应该是输入`select * from GankData;`，之前总是少了分号，所以才看不到表中的数据，现在看到是有保存的，但是奇怪的是读取不成功。
  
  后来终于发现，在读取的时候，首先是`cursor.moveToFirst()`,此时应该就读取第一条数据的，但是我又立刻使用`while(cursor.moveToNext())`，但是因为一开始就只有一条数据，所以当然会没有读取到数据了。
  
  然后发现了一个问题，在读取类别是中文名的时候，失败了，发现在数据库中显示的是正常的中文名字，但是在控制台输出的时候是经过编码的，是`utf-8`的格式，所以在查询前需要使用`Uri.decode(type)`，将`type`解码。
  
  还有就是`setPresenter()`必须放在`onResume`中，否则如何暂时跳到其他应用中，再返回，就会出现空指针的错误，估计就是没有重新实例化`Presenter`的原因。
  
 ** 另外对`volley`增加了一个取消请求的方法，是放在`Presenter`的`onPause()`方法中使用的，但是发现对`Fragment`使用hide方法，并没有调用它的`onPause`方法，这个有点奇怪，需要好好看看。**
 
 此外，在adapter中增加了一个方法用于检查数据是否跟当前数据相同，但是不知为何没有成功。
 
 
---

##### 4.13

   早上看看一些文章的时候，发现了一个facebook发布的一个调试工具`Stetho`，可以通过谷歌浏览器来调试应用的网络连接、数据库等，有空可以将这个也加到应用中。
   
   然后看到关于MVP文章的介绍，有看到解析谷歌官方给的一个MVP例子，这个例子中使用一个契约类`contact`来管理`View`和`presenter`的接口的，就是这两层的接口方法都放在这个契约类中，同时它的activity是一个管理类，在其中实例化`presenter`，然后将其赋给其管理的`fragment`，不过，它这里是一对一的管理，没有涉及到要更换`fragment`，所以，跟我需要实现的优点不同，不过还是可以好好看看的，也打算可以借鉴下，不过这个可以放到后面吧，需要再优化的时候，再考虑这个。
   
   现在考虑的是，解决下数据缓存的bug，然后就是解决下webView无法实现的问题，然后呢，就是学习使用OkHttp以及Retrofit，还有就是应用图标设计。
   
   刚点击一个分类，就出现`java.util.ConcurrentModificationException`这个错误，查了下，网上说的是不能再遍历一个列表的时候，将其中的元素删除掉，解决办法是将要删除的元素先放到另一个列表中，遍历完后，再删除。
   
   这个出错的地方就是之前添加的一个检查数据是否跟当前adapter中的数据相同的函数中，原来方法代码是这样的
   
```
  /**
     * check the data whether already exists in mGanks
     *
     * @param ganks
     */
    public void checkData(List<Gank> ganks) {
        LogUtil.d("adapter",mGanks.size()+"");
        for (Gank gank : ganks) {
            if (mGanks.contains(gank)) {
                mGanks.remove(gank);    // 错误发生的一行代码
            }
        }

    }
```
修改后，代码如下

```
  /**
     * check the data whether already exists in mGanks
     *
     * @param ganks
     */
    public void checkData(List<Gank> ganks) {
        LogUtil.d("adapter",mGanks.size()+"");
        List<Gank> delGanks = new ArrayList<>();
        for (Gank gank : ganks) {
            if (mGanks.contains(gank)) {
                delGanks.add(gank);
            }
        }
        mGanks.removeAll(delGanks);
    }
```

  然后将数据库中的插入操作使用`replace()`函数，而不是`insert()`。
  
  然后就是重新写了WebView的`fragment`，`presenter`,`view`接口以及实现类。发现当将初始化`presenter`以及`webView`的操作放在`onResume`中，就没有出现空指针的错误了！
  
  然后对`WebActivity`的界面进行修改，增加下返回的箭头，还有就是增加几个菜单，有复制链接，在浏览器中打开，以及收藏的功能。这里发现一个问题，就是如果没有等界面加载完毕，就点击返回箭头的话，会出现错误，原因是在`webPresenter`中有写一个方法，在网页加载后，是会调用`IWebView`的`hideRefresh`方法，但是如果直接返回，这个`IWebView`就已经没有了，就会出现空指针的错误。
  
  有想要自己实现下加载时显示进度条的想法。但是还是先解决目前这个bug，返回是在activity中，但是取消加载时presenter中。因为是在之前的方法中先判断`mView`是否为空，不空才执行取消，而让`mView=null`的操作是在`Presenter`的基类中的`onPause`方法就实现的，所以就在点击返回，执行`onBackPressed()`前，先执行下`webFragment`的`onPause`和`onDestroy`方法。这样就解决这个Bug了。
###### 下一步  
  下一步是打算先更换下应用图标，分类的图标，然后再弄下`drawerLayout`的布局，毕竟还有个头部的内容没有弄好，然后添加下设置菜单，关于菜单，还有就是启动页，以及登陆，分享功能，先弄好整体了，再考虑更换数据库，网络请求库以及使用RxJava。另外还要增加一个用来查看图片的activity。
  

---
##### 4.14 总结

  上午，刷微博的时候看到一条微博，++显示了一组动画，都是各种效果，有加载的效果，登录界面，还有就是点击一个按钮，就弹出四个新的按钮的效果，还有搜索的效果，感觉非常赞！到时候优化的时候，可以尝试自己实现其中的几个效果，不过估计要先熟悉下自定义view啊。++
  
  先是在这个网站[](http://iconfont.cn/?spm=a313x.7781069.0.0.Ivz7jM)找到了所有需要的分类的图片，然后利用android studio的`Image Asset`制作成相应的图标，替换原来的图标。
  
  然后在`navigationView`中需要再添加几个菜单，包括设置，我的收藏，关于等，但需要跟前面的分类要有一条分隔线，方法是给两组`group`设置一个`id`,这样就可以自动添加一个分隔线了。
  
  然后就是对于`webView`如果是打开后，又点击文章中的链接到一个新的网页，此时点击返回键应该是可以返回到前一个网页，而不是直接返回到原来的`activity`，一开始是打算尝试回调机制，在activity中声明一个接口，然后在fragment中实现接口的方法，但是发现会出现空指针的错误，上网搜了下，发现可以在fragment中定义两个方法，分别是`canGoBack()`，用来判断是否有历史记录，另一个是`goBack()`方法，就是返回前一个网页，然后在activity的`onKeyDown`方法中，使用`fragment`的实例对象来调用这两个方法，成功实现！
  
  突然发现stackoverflow这个网站真是可以搜到各种好的答案，上述两个问题都是在这找到，唯一需要注意的是英语必须要起码说明你的问题！
###### 下一步    
  明天要做下应用图标，用photoshop做，然后就先是图片的具体显示界面的设计，还有就是设置界面，这个打算使用`sharepreferenceFragment`这个，还有就是关于，以及我的收藏界面，想想，其实还可以设置一个看过的文章界面，然后就是在内容详细界面还要有分享的功能，以及点击菜单的时候，可以使用底部弹出，或者是侧边栏，这是刚看到简书App的设计，对了，还有就是启动页的设计，抽屉菜单的头部布局也要设计，这两个也要优先解决下，以建立一个完整的初始版本为前提。
  
---
##### 4.17 总结
  上午，花了近一个小时吧，才弄好应用图标，而且还不是很好看，只能说看得过去，还是缺乏经验，同时对photoshop也不熟悉。
  
  然后就是在navigationView的头部增加了一个`circleImageView`，用了一个第三方库，本来考虑自己写一个，但是实在是不熟悉，想想还是以后重新看《群英传》的绘图章节的时候，自己再来写一个，现在还是想先尽快实现功能吧。然后设置了回调，就是图片就采用当天的图片，而`textView`则是当天视频的描述内容。这里回调，是在fragment中设置一个接口，并且需要创建一个方法用来设置listener，然后在activity中调用这个设置listener的方法，然后在这里就可以写这个方法实现的具体内容，而在fragment中，在获取数据的地方就调用这个接口中的方法，就可以传入所需要的数据内容。
  
具体实现代码如下：
```
public class MainActivity extends BaseActivity implements mainFragment.FragmentListener{

    ...
    private mainFragment mFragment;
    
    @Override
    protected void onResume() {
        super.onResume();
        // 实例化mainFragment
        mFragment = new mainFragment();
        // 传入listener
        mFragment.setListener(this);
    }
    
    public void setData(String data){
        // 获取到数据
    }
}

public class mainFragment extends Fragment{
    ....
    public interface FragmentListener{
        void setData(String data);
    }
    
    private FragmentListener mFragmentListener;
    
    public void setListener(FragmentListener listener){
        mFragmentListener = listener;
    }
    
    ...
    // 获取数据的方法
    private void getData(String data){
        ...
        // 传入所需要的数据
        mFragmentListener.setData(data);
    }
}
```
上述代码参考了[Android：Activity与Fragment通信(99%)完美解决方案](http://www.jianshu.com/p/1b824e26105b),在这篇文章中是使用了`onAttach()`来绑定listener的，但是这个方法会显示已经被弃用了，所以就自己手动创建一个绑定接口的方法。

  然后实现了双击退出应用的功能。这个也是自己先在`baseActivity`中定义了一个方法，因为只有`mainAcitvity`是会直接退出应用的，还有如`webAcitivty`是要返回到`mainAcitvity`，所以定义的方法中用一个参数来判断，退出的方式是根据时间差。

---
##### 4.18 总结
  今天就是增加了图片的详细查看界面,然后将这几个文件是放在一个新建的文件夹,这是按照功能来放,就是新建一个名为`module_image`表示这个文件夹的文件就是用来实现图片查看功能的，然后实现了可以保存图片到sd卡的功能，新建了一个用来管理保存文件的工具类，但是现在保存图片的方法还是在`imagePresenterImpl`类中写的，然后也实现了，所以打算将这个方法抽出来，封装到管理文件保存的工具类中，同时保存的时候是使用`AsyncTask`这个类，实现异步操作。
  
  然后就是重新写了一个`Toolbar`的基类，然后实现了点击了`toolbar`可以返回顶部的功能，不过这个因为`recycleView`是在`fragment`中实现的，而这个返回顶部的方法是在`activity`中实现的，所以这就需要有点相互之间的通信，感觉写得有点简陋，似乎可以使用`Eventbus`来实现这种`activity`和`fragment`的通信。
  
  **然后看到还可以给文字加载的时候设置显示的动画，即可以从右侧进入，或者从小变大的动画。还有就是想实现向下滑动可以隐藏`Toolbar`的功能。对于图片显示，应该还可以添加一些功能，如长按图片，显示一个对话框来提示是否保存。**
  
  此外，发现一个小问题，就是在图片类别显示中，因为会有数据缓存，所以似乎是无法加载到最新的图片，这个有点小问题，要修复下。
###### 下一步    
  接下来就是实现下设置，关于，我的收藏夹这几个功能，也是使用fragment实现。

---
##### 4.19 总结
  用`PreferenceFragment`这个类实现了设置界面，但是发现好像需要放在设置界面的内容很少，现在就只有3项内容，分别是清除缓存，意见反馈，关于，这样就把关于的界面放在设置里面了。有点少，而且好像界面也不是那么好，同时在`support.v4`包中是不支持这个类的。
  
  然后就是设计了关于的界面，这个使用了`CollapsingToolbarLayout`这个控件，它可以实现向下滑动后，就收起来显示正常的`toolbar`的内容，然后就是想想需要介绍的内容，简单介绍这款app，数据的来源，实现的功能，还有就是用到的开源库，自己的Github地址，个人主页。
  
  这里发现有个bug，但是不知道怎么捕捉，就是在关于界面，然后重新启动程序就会出现奔溃的界面，但是因为这是相当于重新安装一次应用，所以监视器的内容又被更新掉了，没有保留这个错误，所以这个还不知道是什么错误。
  
  意见反馈变成联系我，放在关于界面里面了，直接就是附上邮箱地址，点击就是选择发送邮件的软件。
###### 下一步  
  接下来就是我的收藏夹界面了，这个数据库增加一个表，界面应该也是用`RecycleView`+`CardView`，模仿微信的收藏功能。
  
---
##### 4.20 总结

###### 想法
  其实做这个干货集中营的分享的应用真的挺多的，今天又看到一个，做得界面还是挺美的，一方面用的颜色是粉红色，但看起来的确比我现在用的蓝色要好点，考虑主题颜色要换一下，其次它加载内容的时候用的是`cardView`，并且还使用了动画，这个不错，是可以考虑增加动画；其次加载图片使用的是一个自定义的View，继承自`ImageView`，可以缩放图片，效果还可以，考虑换下这个。
  

---
##### 4.27 总结
  
  因为武汉行的缘故，有近一周没有接触这个项目了。今天首先是改变下布局，使用`cardView`,同时分类就去掉分隔线，显示的内容是主要是标题，左下角是分类标签，右下角是作者以及发布日期。分别用不同的颜色。
  
 实现收藏功能的界面的时候，发现真的还是需要好好看之前写的代码，虽然界面其实应该跟主界面展示技术干货的一样，但是还是有所不同，加载数据是从数据库加载，所以重新建立一个新的表，存储网址链接，标题，作者，类型，保存的时间，同时写了一个新的`adapter`，由于没有使用异步加载数据，所以会出现`Cannot call this method while RecyclerView is computing a layout or scrolling`这个问题，这是在使用`notifyDataSetChanged()`这个更新方法的时候出错，看了网上的答案，其实应该就是加载数据需要异步操作，否则数据多了，`RecyclerView`需要重新计算布局，是不同同时操作的，所以我使用了`AsyncTask`这个类来异步操作。
 
 关于加载数据，其实还是希望需要设置每次加载的数据量，这样可以保证不会太卡，这个需要实现下。
###### 下一步  
 然后打算长按是要弹出一个`dialog`，可以显示转发，删除，编辑标签等操作，这个应该可以使用`dialogFragment`来实现吧，暂时就不继续弄了，今天其实都花了整个下午的时间，虽然感觉还有好多功能可以实现，但是慢慢来，毕竟目前需要学习的很多，也是希望尽快完成这个项目，然后好好总结用到的控件用法，第三方库等，然后就要按照各个知识点的顺序去看官方文档，以及看下对应的源码，希望5月份可以完成这个项目，并且开始总结知识点。
 
---
##### 4.29 总结
  首先是根据数据库在查找的时候，使用其排序的参数，对查找到的数据根据日期进行降序排序，这样就可以实现收藏的文章是按照最新的日期到最老的日期排序。
  
  然后是增加了清除所有收藏文章的功能。本来希望给`webActivity`中的菜单添加icon的，但是对于在overflow，即显示设置了`never`的菜单好像不可以直接显示图标的，寻找了一会，发现网上解决的办法并没有效果，暂时就放弃这个想法。
###### 下一步    
  然后对于加载数据的限制，暂时还是可以考虑不添加的，之后还打算更换用第三方库，如Realm来保存数据。

---
##### 4.30 总结
  
  下午大概用了一个小时，完成了分享功能，包括分享图片，分享文章，以及分享该应用，其中分享图片是需要获取到图片的本地文件，然后用`Uri`来传输，这样分享的就是一张图片，而文章就是分享其标题加网址，至于分享应用，由于还没有发布，所以应用下载地址是还不知道的。

###### 下一步  
  看了下一开始的计划，以及在开发过程中的一些下一步计划，首先是希望更换网络请求库，使用`OkHttp+Retrofit`，然后是封装加载图片的功能，同时实现用Glide可以将图片变成圆形，这样可以少使用一个第三方库，然后就希望改变下Toolbar上那个`overflow`菜单的颜色，现在是黑色，应该使用白色会更配合点，同时实现下沉浸式状态栏，也就是状态栏的颜色可以跟Toolbar的颜色保持一致，之后就打算进行发布了，可能需要使用到友盟来进行数据统计等，暂时希望1.0版本可以在下个月中旬前完成，然后半个月的总结时间，6月份开始逐个知识点进行复习，巩固，阅读相应源码，然后下一个项目大概可能也是下学期初吧，暂时希望做一个小说阅读器或者关于篮球的应用的。
  

---
##### 5.1 总结
  下午对`Glide`加载图片进行封装，同时实现自定义转换图片形式。
  
  首先封装是参考了[羊皮书APP（Android版）开发系列（二十三）10分钟单例模式实战－Glide图片加载库封装工具类](http://www.jianshu.com/p/3804b5d0fb28),同时单例写法看了[你真的会写单例模式吗——Java实现](http://www.tekbroaden.com/singleton-java.html?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io),使用了其中介绍的静态内部类的写法。
  
  然后是实现自定义转换图片形式，主要是实现显示圆形图片，参考的还是上述文章，但是发现显示的一直是正方形的，而不是圆形的，后来看了[Glide - 自定义转换](http://mrfu.me/2016/02/28/Glide_Custom_Transformations/),看到其中提到了使用自定义转换是不能使用`.centerCrop()` 或 `.fitCenter()` 了。而我就是使用了后者这个方法，所以去掉这个方法，发现就成功了。
  
  然后在打算更改`overflow`菜单的颜色的时候，发现菜单栏的标题不可以随着改变，后来发现因为使用了`Toolbar`，所以要调用`Toolbar`的`setTitle`方法，然后使用其`setNavigationIcon`就可以改变导航栏的图标了。
  
  参考的是[Android开发：最详细的 Toolbar 开发实践总结](http://www.jianshu.com/p/79604c3ddcae),[Android开发：Translucent System Bar 的最佳实践](http://www.jianshu.com/p/0acc12c29c1b)
  
  改变`overflow`的方法是需要给`toolbar`设置一个`theme`，要在`style.xml`中增加下面这段
  
```
 <style name="Theme.ToolBar.Base" parent="AppTheme">
        <item name="android:textColorPrimary">@color/md_white</item>
        <item name="actionOverflowButtonStyle">@style/ActionButton.Overflow</item>
    </style>

    <style name="ActionButton.Overflow" parent="android:style/Widget.Holo.Light.ActionButton.Overflow">
        <item name="android:src">@drawable/ic_action_more_overflow</item>
    </style>
```
其中`android:textColorPrimary`这个是设置主标题文章的颜色，而`ActionButton.Overflow`这个style中就是实现改变`overflow`菜单图标的关键，这里使用了自己添加的一个图片代替。

对于状态栏弄了很久，发现只有首页的状态栏总是会出现状态栏和`Toolbar`有部分重叠的情况，而其他的界面都是成功的实现效果了，所以就先打算首页不设置先，其他界面就可以使用，然后到时再看看有没有好的解决方法。

---
##### 5.14 总结
  上周是由于去了两天老家扫墓了，结果回来后这一周状态都很差，几乎没有碰GankCamp项目，可能也是由于基本完成初始版本了，有点松懈了，但其实还是很多地方需要完善的。
  
  今天晚上在参考了许多有关`OkHttp`的文章后，终于是封装好这个库的使用，并且也可以正常使用，用法感觉跟`Volley`差不多，不过这个库可以实现异步操作，同时发现它还是可以进行下载文件，还有就是可以下载图片，这些功能后面有需要再修改。
  
  查看了一些文章发现，其实`Retrofit`也是可以单独使用的，不过其跟`OkHttp`是同一家公司的产品，看到别人介绍其底层也是有`OkHttp`支持的。
  
  参考的文章主要是[Android OkHttp完全解析 是时候来了解OkHttp了](http://blog.csdn.net/lmj623565791/article/details/47911083),[OkHttp使用教程](http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0106/2275.html).
  
  尝试了使用`onSavedInstanceState()`方法来保存当前第一个可见的位置，但是发现没有效果，似乎是有点问题。
  
###### 下一步
  发现缓存功能是需要做点修改，首先是就缓存当天的内容，然后判断是否是同一天打开还是新的一天，如果是新的一天打开就要网络连接，否则就是先加载缓存的内容，然后这个功能就要使用`SharedPreference`来记录下日期，用当天日期跟保存的日期做个判断。
  
  先解决缓存这个问题，然后就是使用`Retrofit`这个库，现在也是基本使用，之后需要的时候再深入探究下其是如何实现的，不过现在要阅读源码还是差了Java的基础，不要急，先做好这个应用，然后巩固好Android的基础，再来阅读源码。
  
  然后之前发现了一篇实现沉浸式状态栏的文章，打算再根据这篇文章实现下这个功能。
  
  其实还有个问题，就是下拉刷新，似乎不能更新最新的内容，这个要解决下。然后就是保存阅读到的文章位置问题，就是在点开一篇文章后返回到主页，需要保存状态。
  

---
##### 5.15 总结
  首先是根据[这个项目](https://github.com/GrogramCat/Bellezza/blob/master/app/src/main/java/com/temoa/bellezza/listener/RecyclerScrollListener.java)也写了一个继承`RecyclerView.OnScrolledListener`的`RecyclerScorllListener`，主要是改写了`onScorlled`方法，并增加了三个抽象方法，分别是`onHide,onShow,LoadMore`，分别实现`Toolbar`的滑动隐藏和显示以及加载更多的功能。
  当是真正运行的时候，发现`Toolbar`的确会消失，但是依然留有一条蓝条，蓝色是本来`Toolbar`的主颜色，即效果相当于只是让文字和图标都消失了，而且原来就设置了有点击`Toolbar`可以返回顶部的功能，所以感觉这个效果是可以不需要的，至少暂时不是必备的。
  所以感觉是做了点无用功，但是有空要研究下这个功能的实现。
  
  之后增加了一个`SharedPreferenceUtil`类来管理`SharedPreference`的存储和获取，然后就是修改下缓存，主要是每日文章部分进行修改了，想想其实还是可以设置加载失败的错误界面以及空界面。

---
##### 5.20 总结
  最近打算开始每天总结下收集的有关Android的资料，每天一个主题，当然如果把这个项目做好了基本版本后，就可以加快点速度，不过做好后打算是要总结下的，所以估计也是能一天一个主题，不过有些主题的内容比较少，就可以加快点。
  
  昨晚是添加了`Retrofit`库的链接，并且写好了接口。
  
  参考了[Retrofit2 完全解析 探索与okhttp之间的关系](http://blog.csdn.net/lmj623565791/article/details/51304204)，[第六篇：网络请求篇（下）](http://www.jianshu.com/p/4c0b9793d0b7)两篇文章，还有就是同样是Gank的开源项目的[GankDaily](https://github.com/maoruibin/GankDaily)以及[Gank.io](https://github.com/Panl/Gank.io)中的写法。
  
  还是花了快一个小时才封装好，然后发现由于可以直接得到需要的`Gank`数据，而之前用其他网络库其实都是得到一个`String`，然后再来分析其是否为空，不空再用Gson解析得到需要的对象，但是现在可以直接得到，所以对得到结果的处理需要进行处理，同时数据缓存也需要修改。
  
  数据缓存方法，就用`Gson`的`toJson()`方法来保存获得的数据，将其解析成`String`类型。
  
  花了快两个小时，修改好，但是突然发现类别的加载数据的时候，应该是从数据库加载的时候是会比较卡的，但是在读取数据库的操作上已经使用了`Handler`的`post()`方法。现在这个分类的缓存还是很有问题。
  
---
##### 5.21 总结
  今天首先是看到一个Java的HTML的解析库--`Jsoup`，可以用来解析网页，感觉后面如果要做一个小说阅读器或者篮球相关的APP，但是有没有API，也没写爬虫的时候，还是可以使用这个来做下的。
  
  发现昨天的问题还是存在，而且主要是数据库读取问题，所以现在就删掉分类缓存的功能，暂时搁置，然后一个问题就是界面卡的问题，这个暂时还想不到什么办法，要上网搜索下。
  
###### 下一步
  网络库更换完毕，然后就是打算添加友盟统计，然后发布初始版本，毕竟还是第一次发布到一些应用市场上的。然后就添加下登陆功能，夜间模式，头像更换，启动页面等。

---
##### 5.22 总结
  今天下载了友盟的SDK，然后添加，并且按照官方文档在代码中添加了一些必要的代码，主要是用来统计页面的次数以及时长，然后修改了`app/build.gradle`中的内容，添加了如签名文件等。
  
  明天就可以打包，然后发布到`Fir.im`这个应用市场了。
  

---
##### 5.24 总结
  昨天因为一些事情没有按计划进行，今天首先是生成签名文件，参考了[Android Studio 生成签名的APK](http://blog.csdn.net/renfufei/article/details/50085091),然后就是生成release版本的apk，并且上传到`fir.im`，现在就可以下载使用了。
  
  然后就试着下载使用，不过使用过程突然遇到一个奔溃，刚好是一个时间管理应用的计时时间到了，同时刚好是从首页点击到android这个类别，是需要添加一些奔溃统计。所以就使用[BugHD 使用手册](http://bughd.com/doc/index)这个也是`fir.im`提供的一个工具。
  
  然后今天看到另一个干货的客户端，感觉其界面做得不错，它也有分类，但是是使用`ViewPager`，然后使用第三方库的`MaterialDrawer`代替官方的`NavigtionView+DrawerLayout`，不过看了介绍，不得不说是比官方更强。
  
  