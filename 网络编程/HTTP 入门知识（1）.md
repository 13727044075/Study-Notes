# HTTP 入门知识（1）

这是在阅读了《图解 HTTP》这本书后，所做的学习笔记，并且参考了以下几篇文章：

- [HTTP 简介（菜鸟教程）](http://www.runoob.com/http/http-intro.html)
- [关于HTTP协议，一篇就够了](https://www.cnblogs.com/ranyonsue/p/5984001.html)
- [HTTP 方法：GET 对比 POST](http://www.w3school.com.cn/tags/html_ref_httpmethods.asp)

关于 HTTP 的学习笔记，将分为 8 篇。本次是第 1 篇，主要介绍 HTTP 的起源、特点和工作原理。

### 1. HTTP  起源

HTTP（Hyper Text Transfer Protocol），也就是超文本传输协议，其设计的目的就是保证客户端和服务器之间的通信，其工作方式就是客户端和服务器之间的请求-响应协议。它是一个基于 TCP/IP 通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）

HTTP/1.0 版本诞生于 1996 年 5 月份，但随后 1.1 版本在 1997 年 1月份公布，是目前最主流的 HTTP 协议版本，而在 2015 年则公布了 HTTP/2.0 版本。

### 2. 特点

HTTP 协议具有以下几个特点：

- **简单快速**：客户向服务器请求服务时，只需传送请求方法和路径。由于 HTTP 协议简单，使得 HTTP 服务器的程序规模小，因而通信速度很快。
- **灵活**：HTTP 允许传输任意类型的数据对象。正在传输的类型由 Content-Type 加以标记。
- **HTTP是无连接**：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
- **HTTP是媒体独立的**：这意味着，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过 HTTP 发送。客户端以及服务器指定使用适合的 MIME-type 内容类型。
- **HTTP是无状态**：HTTP 协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。后续引入 Cookie 技术解决这个问题。
- 使用**统一资源标识符（Uniform Resource Identifiers, URI）**来传输数据和建立连接。
- 支持 B/S 和 C/S 模式，即浏览器/服务器和客户端/服务器模式

### 3.  缺点

- 通信使用明文（不加密），内容可能会被窃听
- 不验证通信方的身份，因此可能遭遇伪装
  - 有可能遭遇伪装的 Web 服务器
  - 有可能遭遇已伪装的客户端
  - 无法确定正在通信的对方是否具备访问权限
  - 无法判定请求是来自何方、出自谁手
  - 即使是无意义的请求也会照单全收。无法阻止海量请求下的 DoS 攻击(Denial of Service，拒绝服务攻击)
- 无法证明报文的完整性，所以有可能已遭篡改
  - 请求或响应在传输途中，遭攻击者拦截并篡改内容的攻击被称为中间人攻击（Man-in-the-Middle attack, MITM）

### 4.  工作原理

HTTP 协议定义 Web 客户端如何从 Web 服务器请求 Web 页面，以及服务器如何把 Web 页面传送给客户端。HTTP 协议采用了请求/响应模型。客户端向服务器发送一个请求报文，请求报文包含请求的方法、URL、协议版本、请求头部和请求数据。服务器以一个状态行作为响应，响应的内容包括协议的版本、成功或者错误代码、服务器信息、响应头部和响应数据。

以下是 HTTP 请求/响应的步骤：

**1、客户端连接到 Web 服务器**
一个 HTTP 客户端，通常是浏览器，与 Web 服务器的 HTTP 端口（默认为 80）建立一个 TCP 套接字连接。例如，http://www.oakcms.cn。

**2、发送 HTTP 请求**
通过 TCP 套接字，客户端向 Web 服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、空行和请求数据 4 部分组成。

**3、服务器接受请求并返回 HTTP 响应**
Web 服务器解析请求，定位请求资源。服务器将资源复本写到 TCP 套接字，由客户端读取。一个响应由状态行、响应头部、空行和响应数据 4 部分组成。

**4、释放连接 TCP 连接**
若 connection 模式为 close，则服务器主动关闭 TCP 连接，客户端被动关闭连接，释放 TCP 连接;若 connection 模式为 keep-alive，则该连接会保持一段时间，在该时间内可以继续接收请求;

**5、客户端浏览器解析HTML内容**
客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的 HTML 文档和文档的字符集。客户端浏览器读取响应数据 HTML ，根据 HTML 的语法对其进行格式化，并在浏览器窗口中显示。

例如：在浏览器地址栏键入 URL，按下回车之后会经历以下流程：

1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;

2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;

3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;

4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;

5、释放 TCP连接;

6、浏览器将该 html 文本并显示内容; 

### 5. 持久连接

HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接。在当时都是容量很小的文本传输的通信情况看，这个做法并没有什么问题。但是随着 HTTP 的普及，文档中包含大量图片的情况多了起来，当文档包含大量图片的时候，比如使用浏览器浏览一个包含多张图片的 HTML 页面的时候，会发生多次请求，但每次请求都会造成无谓的 TCP 连接和断开，增加了通信量的开销。

为解决上述问题，在 HTTP/1.0 版本中提出了持久连接（HTTP Persistent Connections, 也称为 HTTP keep-alive 或 HTTP connection reuse）的方法，**其特点是，只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。**

持久连接的好处在于减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器的负载。另外减小开销的那部分时间，使 HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相应提高了。

### 6. 管线化

持久连接使得多数请求得以管线化（pipelinling）方式发送成为可能。从前发送请求必须等待并收到响应后，才能发送下一个请求。但管线化技术出现后，可以做到**同时并行发送多个请求**，不需要一个一个等待响应。

管线化技术比持久连接还要快，并且请求数量越多，时间差就越明显。



